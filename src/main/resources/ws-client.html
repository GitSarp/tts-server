<html><head>    <title>Simple client</title>    <script type="text/javascript">        var ws;        //是否在等待服务器返回消息        var isReading = false;        function init() {            // Connect to Web Socket            ws = new WebSocket("ws://localhost:8888/ws");            //arraybuffer            ws.binaryType = 'arraybuffer';            // Set event handlers.            ws.onopen = function() {                output("onopen");            };            ws.onmessage = function(msg) {                // msg.data contains received string.                //console.log(msg.data);                //output("onmessage: " + msg.data);                //FileReader播放音频                var data =  msg.data;                var datalen = msg.data.size;                var reader = new FileReader();                var audioContext = new AudioContext({                    sampleRate:8000,                });                reader.onload = function(evt)                {                    if(evt.target.readyState == FileReader.DONE)                    {                        audioContext.decodeAudioData(data, function(buffer) {                            //console.log("decode success");                            if(buffer.length == 0) {                                isReading = false;                            } else {                                var bufferSource = audioContext.createBufferSource();                                bufferSource.connect(audioContext.destination);                                bufferSource.buffer = buffer;                                bufferSource.start(0);                                bufferSource.onended = (event) => {isReading = false;}                            }                        }, function(e) {                            console.log("decode failed: " + e);                            isReading = false;                        });                    }                }                reader.readAsArrayBuffer(new Blob([data]));                //audio播放音频/*                var audio = document.getElementById('aud');                audio.src = URL.createObjectURL(msg.data);                audio.load();*/            };            ws.onclose = function() {                output("onclose");            };            ws.onerror = function(e) {                output("onerror");                console.log(e)            };            //模拟sleep            const sleep = (delay) => new Promise((resolve) => setTimeout(resolve, delay))            //阅读本地文件            document.getElementById('file').onchange = function(){                var file = this.files[0];                output("readLocalFile: " + file.name);                var reader = new FileReader();                reader.onload = function(progressEvent){                    var lines = this.result.split(/\r\n|\n/);                    async function readLines() {                        for(var line = 0; line < lines.length-1; line++){                            if(lines[line].trim().length == 0) {                                continue;                            }                            //console.log(line + " --> "+ lines[line]);                            while(isReading) {                                await sleep(200)                            }                            ws.send("read:" + lines[line].trim());                            isReading=true;                        }                    }                    readLines();                };                reader.readAsText(file, "GB2312");            }        }        function onSubmit() {            var input = document.getElementById("input");            var inputFile = document.getElementById("input2");            // You can send message to the Web Socket using ws.send.            if(input.value.trim().length > 0) {                output("read: " + input.value);                ws.send("read:" + input.value);                input.value = "";                input.focus();            }            if(inputFile.value.trim().length > 0) {                output("readFile: " + inputFile.value);                ws.send("readFile:" + inputFile.value);                inputFile.value = "";                inputFile.focus();            }        }        function onCloseClick() {            ws.close();        }        function output(str) {            var log = document.getElementById("log");            var escaped = str.replace(/&/, "&amp;").replace(/</, "&lt;").            replace(/>/, "&gt;").replace(/"/, "&quot;"); // "            log.innerHTML = escaped + "<br>" + log.innerHTML;        }    </script></head><body onload="init();"><form onsubmit="onSubmit(); return false;">    <p>朗读句子：</p>    <input type="text" id="input">    <input type="submit" value="Send">    <button onclick="onCloseClick(); return false;">close</button>    <p>朗读远程文件(存在问题)：</p>    <input type="text" id="input2">    <input type="submit" value="Send">    <button onclick="onCloseClick(); return false;">close</button></form><p>朗读本地文件：</p><input type="file" name="file" id="file"/><!--<audio id="aud" ref="audio" controls="controls" ></audio>--><br><br><div id="log"></div></body></html>